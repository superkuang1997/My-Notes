# 消息队列

## 应用场景

使用消息队列能为我们的系统带来下面三点好处：

1. 通过异步处理提高系统性能（减少响应所需时间）。

2. 削峰/限流

3. 降低系统耦合性。

   

### 异步

将用户的请求数据存储到消息队列之后就立即返回结果。随后，系统再对消息进行消费。

例如用户在提交订单之后，订单数据写入消息队列，不能立即返回用户订单提交成功，需要在消息队列的订单消费者进程真正处理完该订单之后，再通过电子邮件或短信通知用户订单成功。

<img src="http://store.secretcamp.cn/uPic/image-20210825165010508202108251650101629881410BRL2siBRL2si.png" alt="image-20210825165010508" style="zoom:50%;" />





### 流量削峰

应用系统如果遇到系统请求流量的瞬间猛增，有可能会将系统压垮。有了消息队列可以将大量请求缓存起来，分散到很长一段时间处理，这样可以大大提到系统的稳定性和用户体验。

<img src="http://store.secretcamp.cn/uPic/image-20210825164933969202108251649341629881374ScFeY0ScFeY0.png" alt="image-20210825164933969" style="zoom:50%;" />



### 系统解耦

通过消息队列可以让数据在多个系统更加之间进行流通，数据的产生方不需要关心谁来使用数据，只需要将数据发送到消息队列，数据使用方直接在消息队列中直接获取数据即可。

消息接受者从分布式消息队列获取该消息后进行后续处理，并不需要知道该消息从何而来。

<img src="http://store.secretcamp.cn/uPic/image-20210425105202329202104251052021619319122lneWLClneWLC.png" alt="image-20210425105202329" style="zoom:50%;" />





## 缺点

1. 降低系统的可用性：系统引入的外部依赖越多，越容易挂掉； 
2. 系统复杂度提高：使用 MQ 后可能需要保证消息没有被重复消费、处理消息丢失的情况、保证消息传递的顺序性等等问题；
   



## 常见的消息队列对比

|          | 吞吐量 | 可用性 | 时效性 | 功能支持 | 消息丢失   | 开发语言 |
| -------- | ------ | ------ | ------ | -------- | ---------- | -------- |
| ActiveMQ | W+     | 主从   | 毫秒级 |          | 可能性很小 |          |
| RabbitMQ | W+     | 主从   | 微秒级 |          | 可能性很小 | erlang   |
| RocketMQ | 10W+   | 分布式 | 毫秒级 |          | 理论上不丢 | java     |
| Kafka    | 10W+   | 分布式 | 毫秒级 |          | 理论上不丢 |          |

